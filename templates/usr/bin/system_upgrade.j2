#!/bin/bash
set -euo pipefail

[ $EUID != 0 ] && (
	/usr/bin/echo "Please run as root."
	exit 1
)

change_runlevel() {
	/usr/bin/cp -p /etc/runit/2{,.bak}
	/usr/bin/sed -ie 's/^runlevel=.*$/runlevel=upgrade/' /etc/runit/2
}

system_restart() {
	/usr/bin/reboot
}

/usr/bin/echo Start script...

/usr/bin/echo interactive mode? confirm reboot now

/usr/bin/echo download packages to cache
/usr/bin/echo set runlevel
/usr/bin/echo reboot

/usr/bin/echo Only run when no-one is logged in. Also force_users option?

# Set runlevel to upgrade
change_runlevel()

# Reboot the host
system_restart()
